<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breakout - Neon Edition</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'VT323', monospace;
      background-color: #121212;
      color: #f8f8f2;
      min-height: 100vh;
      margin: 0;
      padding-top: 64px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #gameCanvas {
      border: 2px solid #ffcc00;
      background-color: #1e1e1e;
      display: block;
      margin: 2rem auto;
    }

    .controls {
      margin-bottom: 2rem;
    }

    .btn {
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      background-color: #ffcc00;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background-color: #ffdd57;
      transform: translateY(-2px);
    }

    .score {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .lives {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    .instructions {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

  <header id="header-placeholder"></header>

  <div class="score">Score: <span id="score">0</span></div>
  <div class="lives">Lives: <span id="lives">3</span></div>
  <canvas id="gameCanvas" width="480" height="320"></canvas>
  <div class="controls">
    <button id="startButton" class="btn">‚ñ∂Ô∏è Start</button>
    <button id="resetButton" class="btn">üîÑ Reset</button>
  </div>
  <div class="instructions">
    Use ‚Üê ‚Üí Arrow Keys to move paddle
  </div>

  <footer id="footer-placeholder"></footer>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    const livesElement = document.getElementById('lives');
    const startButton = document.getElementById('startButton');
    const resetButton = document.getElementById('resetButton');

    // Game variables
    let score = 0;
    let lives = 3;
    let gameRunning = false;
    let animationId;

    // Paddle
    const paddle = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 20,
      width: 80,
      height: 10,
      speed: 5,
      dx: 0
    };

    // Ball
    const ball = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      radius: 8,
      speed: 3,
      dx: 2,
      dy: -2
    };

    // Bricks
    const brickRowCount = 5;
    const brickColumnCount = 8;
    const brickWidth = 50;
    const brickHeight = 20;
    const brickPadding = 5;
    const brickOffsetTop = 30;
    const brickOffsetLeft = 30;

    let bricks = [];

    function initBricks() {
      bricks = [];
      for (let c = 0; c < brickColumnCount; c++) {
        bricks[c] = [];
        for (let r = 0; r < brickRowCount; r++) {
          bricks[c][r] = { 
            x: 0, 
            y: 0, 
            status: 1,
            color: `hsl(${r * 30}, 70%, 50%)`
          };
        }
      }
    }

    function drawPaddle() {
      ctx.fillStyle = '#ffcc00';
      ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = '#ff4444';
      ctx.fill();
      ctx.closePath();
    }

    function drawBricks() {
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          if (bricks[c][r].status === 1) {
            const brickX = c * (brickWidth + brickPadding) + brickOffsetLeft;
            const brickY = r * (brickHeight + brickPadding) + brickOffsetTop;
            bricks[c][r].x = brickX;
            bricks[c][r].y = brickY;
            
            ctx.fillStyle = bricks[c][r].color;
            ctx.fillRect(brickX, brickY, brickWidth, brickHeight);
          }
        }
      }
    }

    function collisionDetection() {
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          const b = bricks[c][r];
          if (b.status === 1) {
            if (
              ball.x > b.x &&
              ball.x < b.x + brickWidth &&
              ball.y > b.y &&
              ball.y < b.y + brickHeight
            ) {
              ball.dy = -ball.dy;
              b.status = 0;
              score += 10;
              scoreElement.textContent = score;
              
              if (score === brickRowCount * brickColumnCount * 10) {
                alert('Congratulations! You won!');
                gameRunning = false;
              }
            }
          }
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBricks();
      drawBall();
      drawPaddle();
      collisionDetection();

      // Ball collision with walls
      if (ball.x + ball.dx > canvas.width - ball.radius || ball.x + ball.dx < ball.radius) {
        ball.dx = -ball.dx;
      }
      if (ball.y + ball.dy < ball.radius) {
        ball.dy = -ball.dy;
      } else if (ball.y + ball.dy > canvas.height - ball.radius) {
        if (ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
          ball.dy = -ball.dy;
          // Add some angle based on where ball hits paddle
          const hitPos = (ball.x - paddle.x) / paddle.width;
          ball.dx = 8 * (hitPos - 0.5);
        } else {
          lives--;
          livesElement.textContent = lives;
          if (lives === 0) {
            alert('Game Over!');
            gameRunning = false;
          } else {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.dx = 2;
            ball.dy = -2;
            paddle.x = canvas.width / 2 - paddle.width / 2;
          }
        }
      }

      // Move paddle
      paddle.x += paddle.dx;
      if (paddle.x < 0) paddle.x = 0;
      if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;

      // Move ball
      ball.x += ball.dx;
      ball.y += ball.dy;

      if (gameRunning) {
        animationId = requestAnimationFrame(draw);
      }
    }

    function startGame() {
      if (!gameRunning) {
        gameRunning = true;
        draw();
      }
    }

    function resetGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      score = 0;
      lives = 3;
      scoreElement.textContent = score;
      livesElement.textContent = lives;
      ball.x = canvas.width / 2;
      ball.y = canvas.height / 2;
      ball.dx = 2;
      ball.dy = -2;
      paddle.x = canvas.width / 2 - paddle.width / 2;
      initBricks();
      draw();
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        paddle.dx = -paddle.speed;
      } else if (e.key === 'ArrowRight') {
        paddle.dx = paddle.speed;
      }
    });

    document.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        paddle.dx = 0;
      }
    });

    startButton.addEventListener('click', startGame);
    resetButton.addEventListener('click', resetGame);

    // Load header and footer
    document.addEventListener('DOMContentLoaded', function() {
      fetch('../pages/header.html')
        .then(r => r.text())
        .then(html => {
          document.getElementById('header-placeholder').innerHTML = html;
          if (typeof initializeHeader === 'function') {
            initializeHeader();
          }
        })
        .catch(err => console.error('Error loading header:', err));

      fetch('../pages/footer.html')
        .then(r => r.text())
        .then(html => {
          document.getElementById('footer-placeholder').innerHTML = html;
          if (typeof initializeFooter === 'function') {
            initializeFooter();
          }
        })
        .catch(err => console.error('Error loading footer:', err));

      initBricks();
      draw();
    });
  </script>
</body>
</html>
